/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){"use strict";var t=angular.module("rmDatepicker",[]);t.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,format:"dd/MM/yyyy"}),t.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(t,e,a,n,i){var o=function(o,r,l,c){var d=angular.copy(t);if(o.rmConfig)for(var m in d)d.hasOwnProperty(m)&&void 0!=o.rmConfig[m]&&(d[m]=o.rmConfig[m]);d.min&&d.min.setHours(0,0,0,0),d.max&&d.max.setHours(23,59,59,999);var f="INPUT"==r[0].tagName.toUpperCase(),g={min:!1,max:!1},u=function(t,e){return new Date(t,e+1,0).getDate()},D=function(t){var t=parseInt(t,10);if(!isNaN(t)){var e=u(o.model.getFullYear(),o.model.getMonth());t<1&&(t=1),t>e&&(t=e),o.model.setDate(t)}},p={decade:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=t.getDate(),o=0,s=d.decadeSize||12,r=new Array(s);for(a=Math.floor(a/s)*s;o<s;a++,o++)e=u(a,n),i>e&&(i=e),r[o]=new Date(a,n,i,3,0,1,0);return r},year:function(t){for(var e,a=t.getFullYear(),n=0,i=t.getDate(),o=[];n<12;n++)e=u(a,n),i>e&&(i=e),o.push(new Date(a,n,i,3,0,1,0));return o},month:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=new Date(a,n,1,3,0,1,0),s=i.getDay()||7;return o.mondayStart&&(s=s-1||7),e="auto"==d.monthSize?s+u(a,n)<35?35:42:d.monthSize,i.setDate(-s+1),p.dates(i,e)},dates:function(t,e){for(var a=new Array(e),n=new Date(t),i=0;i<e;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},v=function(t){if(t=t||o.state,o.model&&(o.model=new Date(o.model),o.initialDate=o.model),o.aDates=p[t](o.initialDate),d.min&&(g.min=o.aDates[0]<d.min),d.max){var e=o.aDates[o.aDates.length-1];g.max=e>d.max}},y=function(){o.initialDate=new Date(o.initialDate||o.model||new Date),o.$watch(o.initialDate,function(){v()})},h=function(t,e){return"decade"==o.state?t.getFullYear()<e.getFullYear():"year"==o.state?t.getFullYear()==e.getFullYear()?t.getMonth()<e.getMonth():t.getFullYear()<e.getFullYear():t<e};o.isOff=function(t){return!(!d.min&&!d.max)&&(!(!d.min||!h(t,d.min))||(!(!d.max||!h(d.max,t))||void 0))},o.isActive={year:function(t){return t.getFullYear()==o.initialDate.getFullYear()},month:function(t){return t.getMonth()==o.initialDate.getMonth()},date:function(t){return t.getDate()==o.initialDate.getDate()}},o.isToday=function(t){return o.isActive.date(t)&&o.isActive.month(t)&&o.isActive.year(t)},o.go=function(t){if(!o.isOff(t)){f&&o.state==d.minState&&o.isActive.month(t)&&x(!1);var e=o.initialDate.getMonth();o.model=new Date(t),o.initialDate=o.model,i(function(){c.$setViewValue(o.model)}),d.toggleState&&o.toggleState(1),e!=o.initialDate.getMonth()&&v()}},o.now=function(){o.model=new Date,o.initialDate=o.model,v()},o.next=function(t){if(o.model=o.model||o.initialDate,t=t||1,t>0){if(g.max)return}else if(g.min)return;var e=o.model.getFullYear(),a=o.model.getMonth(),n=o.model.getDate();switch(o.state){case"decade":t*=o.aDates.length;case"year":o.model.setFullYear(e+t,a,15),D(n);break;case"month":o.model.setMonth(a+t,15),D(n);break;case"week":o.model.setDate(n+7*t)}v()},o.prev=function(t){return o.next(-t||-1)},o.toggleState=function(t){t=t||1,o.state==d.maxState&&t==-1||o.state==d.minState&&1==t||(o.state=o.aStates[o.aStates.indexOf(o.state)+t],v())},o.mondayStart=d.mondayStart,o.textToday=d.textToday,o.aStates=["decade","year","month"],o.state=d.initState,y();var w=function(t,e){var a=0,n=0;do a+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;while(t!=e);return{top:n,left:a}},x=function(t){M.css("display",t?"block":"none"),F.css("display",t?"block":"none")},k=function(t,e,a){var n=t.top+e.clientHeight-a.clientHeight;return n>0&&(t.top-=n+5),t};if(f){c.$parsers.push(function(t){return new Date(t)}),c.$formatters.push(function(t){return a("date")(t,d.format)});var M=angular.element('<div class="rm-overlay" style="display:none"></div>');M.on("click",function(){x(!1)});var S=r.closest(".scroll-container");S.append(M),M.after(e(s)(o));var F=M.next();F.css({display:"none"}),F.addClass("it-is-input"),r.on("click",function(){var t=r[0];if(!t.readOnly){window.innerWidth<481&&t.blur();var e=w(t,S.get(0));e.top+=t.offsetHeight+1,F.css({top:e.top+"px",left:e.left+"px",display:"block"}),x(!0),k(e,F.get(0),S.get(0)),F.css({top:e.top+"px",left:e.left+"px"})}}),n.on("keydown",function(t){[9,13,27].indexOf(t.keyCode)>=0&&x(!1)})}else r.append(e(s)(o))},s='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a><i class="mi_arrow_back"></i></a><a class="back waves-effect" ng-click="toggleState(-1)"><span ng-show="state == \'decade\'">{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}</span><span ng-show="state == \'year\'">{{initialDate.getFullYear()}}</span><span ng-show="state == \'month\'">{{initialDate | date: \'MMMM yyyy\'}}</span><span ng-show="state == \'week\'">{{initialDate | date: \'d MMMM yyyy\' }}</span></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div><script type="text/ng-template" id="rm-decade.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'year\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-year.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'month\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-month.html"><div class="day sunSat" ng-if="state == \'month\'"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'date\'](oDate), off: isOff(oDate), out: !isActive[\'month\'](oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div></script>';return{require:"ngModel",scope:{model:"=ngModel",initialDate:"=?rmInitialDate",rmConfig:"=rmConfig"},link:o}}])}();